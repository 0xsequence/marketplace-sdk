{"version":3,"file":"listCollectibles-Dl3tB-_4.js","names":["params: FetchListCollectiblesParams","marketplaceConfig: MarketplaceConfig","page: Page","apiArgs: ListCollectiblesArgs","collectibles: CollectibleOrder[]","params: ListCollectiblesQueryOptions"],"sources":["../src/react/queries/listCollectibles.ts"],"sourcesContent":["import { infiniteQueryOptions } from '@tanstack/react-query';\nimport type { Address } from 'viem';\nimport type { MarketplaceConfig, Page, SdkConfig } from '../../types';\nimport type { MarketplaceType } from '../../types/types';\nimport { compareAddress } from '../../utils';\nimport type {\n\tListCollectiblesArgs,\n\tListCollectiblesReturn,\n\tValuesOptional,\n} from '../_internal';\nimport {\n\ttype CollectibleOrder,\n\tcollectableKeys,\n\tgetMarketplaceClient,\n\tOrderSide,\n} from '../_internal';\nimport { fetchMarketplaceConfig } from '../queries/marketplaceConfig';\nimport type { StandardInfiniteQueryOptions } from '../types/query';\nimport { fetchBalances, type UseListBalancesArgs } from './listBalances';\n\nexport interface FetchListCollectiblesParams\n\textends Omit<ListCollectiblesArgs, 'chainId' | 'contractAddress'> {\n\tchainId: number;\n\tcollectionAddress: Address;\n\tisLaos721?: boolean;\n\tmarketplaceType?: MarketplaceType;\n\tconfig: SdkConfig;\n}\n\n/**\n * Fetches a list of collectibles with pagination support from the Marketplace API\n */\nexport async function fetchListCollectibles(\n\tparams: FetchListCollectiblesParams,\n\tmarketplaceConfig: MarketplaceConfig,\n\tpage: Page,\n): Promise<ListCollectiblesReturn> {\n\tconst { collectionAddress, chainId, config, ...additionalApiParams } = params;\n\tconst marketplaceClient = getMarketplaceClient(config);\n\n\tconst apiArgs: ListCollectiblesArgs = {\n\t\tcontractAddress: collectionAddress,\n\t\tchainId: String(chainId),\n\t\tpage: page,\n\t\t...additionalApiParams,\n\t};\n\n\tif (params.marketplaceType === 'shop') {\n\t\tconst shopCollection = marketplaceConfig.shop.collections.find(\n\t\t\t(collection) =>\n\t\t\t\tcompareAddress(collection.itemsAddress, params.collectionAddress),\n\t\t);\n\n\t\tif (!shopCollection) {\n\t\t\treturn { collectibles: [] };\n\t\t}\n\n\t\tconst primarySaleItemsList = await marketplaceClient.listPrimarySaleItems(\n\t\t\t{\n\t\t\t\tchainId: params.chainId.toString(),\n\t\t\t\tprimarySaleContractAddress: shopCollection.saleAddress as Address,\n\t\t\t},\n\t\t\tmarketplaceConfig,\n\t\t);\n\n\t\treturn {\n\t\t\tcollectibles: primarySaleItemsList.primarySaleItems.map((item) => ({\n\t\t\t\tmetadata: item.metadata,\n\t\t\t\tprimarySale: {\n\t\t\t\t\tprice: {\n\t\t\t\t\t\tamount: item.primarySaleItem.priceAmount,\n\t\t\t\t\t\tformatted: item.primarySaleItem.priceAmountFormatted,\n\t\t\t\t\t\tdecimals: item.primarySaleItem.priceDecimals,\n\t\t\t\t\t\tcurrencyAddress: item.primarySaleItem.currencyAddress,\n\t\t\t\t\t},\n\t\t\t\t\tstartDate: item.primarySaleItem.startDate,\n\t\t\t\t\tendDate: item.primarySaleItem.endDate,\n\t\t\t\t\tsupplyCap: item.primarySaleItem.supply,\n\t\t\t\t\titemType: item.primarySaleItem.itemType,\n\t\t\t\t},\n\t\t\t})),\n\t\t};\n\t}\n\n\tif (params.isLaos721 && params.side === OrderSide.listing) {\n\t\ttry {\n\t\t\tconst fetchBalancesArgs = {\n\t\t\t\tchainId: params.chainId,\n\t\t\t\taccountAddress: params.filter?.inAccounts?.[0] as Address,\n\t\t\t\tcontractAddress: params.collectionAddress,\n\t\t\t\tpage: page,\n\t\t\t\tincludeMetadata: true,\n\t\t\t\tisLaos721: true,\n\t\t\t} satisfies UseListBalancesArgs;\n\n\t\t\tconst balances = await fetchBalances(fetchBalancesArgs, config, page);\n\t\t\tconst collectibles: CollectibleOrder[] = balances.balances.map(\n\t\t\t\t(balance) => {\n\t\t\t\t\tif (!balance.tokenMetadata)\n\t\t\t\t\t\tthrow new Error('Token metadata not found');\n\t\t\t\t\treturn {\n\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\ttokenId: balance.tokenID ?? '',\n\t\t\t\t\t\t\tattributes: balance.tokenMetadata.attributes,\n\t\t\t\t\t\t\timage: balance.tokenMetadata.image,\n\t\t\t\t\t\t\tname: balance.tokenMetadata.name,\n\t\t\t\t\t\t\tdescription: balance.tokenMetadata.description,\n\t\t\t\t\t\t\tvideo: balance.tokenMetadata.video,\n\t\t\t\t\t\t\taudio: balance.tokenMetadata.audio,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tcollectibles: collectibles,\n\t\t\t\t//@ts-expect-error\n\t\t\t\tpage: balances.page,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\t// If the request fails, ignore the error and return the collectibles from our indexer\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\treturn await marketplaceClient.listCollectibles(apiArgs);\n}\n\nexport type ListCollectiblesQueryOptions =\n\tValuesOptional<FetchListCollectiblesParams> & {\n\t\tquery?: StandardInfiniteQueryOptions;\n\t};\n\nexport function listCollectiblesQueryOptions(\n\tparams: ListCollectiblesQueryOptions,\n) {\n\tconst enabled = Boolean(\n\t\tparams.collectionAddress &&\n\t\t\tparams.chainId &&\n\t\t\tparams.side &&\n\t\t\tparams.config &&\n\t\t\t(params.query?.enabled ?? true),\n\t);\n\n\treturn infiniteQueryOptions({\n\t\tqueryKey: [...collectableKeys.lists, params],\n\t\tqueryFn: async ({ pageParam }) => {\n\t\t\tconst marketplaceConfig = await fetchMarketplaceConfig({\n\t\t\t\t// biome-ignore lint/style/noNonNullAssertion: The enabled check above ensures these are not undefined\n\t\t\t\tconfig: params.config!,\n\t\t\t});\n\t\t\treturn fetchListCollectibles(\n\t\t\t\t{\n\t\t\t\t\t// biome-ignore lint/style/noNonNullAssertion: The enabled check above ensures these are not undefined\n\t\t\t\t\tchainId: params.chainId!,\n\t\t\t\t\t// biome-ignore lint/style/noNonNullAssertion: The enabled check above ensures these are not undefined\n\t\t\t\t\tcollectionAddress: params.collectionAddress!,\n\t\t\t\t\t// biome-ignore lint/style/noNonNullAssertion: The enabled check above ensures these are not undefined\n\t\t\t\t\tconfig: params.config!,\n\t\t\t\t\t// biome-ignore lint/style/noNonNullAssertion: The enabled check above ensures these are not undefined\n\t\t\t\t\tside: params.side!,\n\t\t\t\t\tfilter: params.filter,\n\t\t\t\t\tisLaos721: params.isLaos721,\n\t\t\t\t\tmarketplaceType: params.marketplaceType,\n\t\t\t\t},\n\t\t\t\tmarketplaceConfig,\n\t\t\t\tpageParam,\n\t\t\t);\n\t\t},\n\t\tinitialPageParam: { page: 1, pageSize: 30 } as Page,\n\t\tgetNextPageParam: (lastPage) =>\n\t\t\tlastPage.page?.more ? lastPage.page : undefined,\n\t\t...params.query,\n\t\tenabled,\n\t});\n}\n"],"mappings":";;;;;;;;;;;AAgCA,eAAsB,sBACrBA,QACAC,mBACAC,MACkC;CAClC,MAAM,EAAE,mBAAmB,SAAS,OAAQ,GAAG,qBAAqB,GAAG;CACvE,MAAM,oBAAoB,qBAAqB,OAAO;CAEtD,MAAMC,UAAgC;EACrC,iBAAiB;EACjB,SAAS,OAAO,QAAQ;EAClB;EACN,GAAG;CACH;AAED,KAAI,OAAO,oBAAoB,QAAQ;EACtC,MAAM,iBAAiB,kBAAkB,KAAK,YAAY,KACzD,CAAC,eACA,eAAe,WAAW,cAAc,OAAO,kBAAkB,CAClE;AAED,OAAK,eACJ,QAAO,EAAE,cAAc,CAAE,EAAE;EAG5B,MAAM,uBAAuB,MAAM,kBAAkB,qBACpD;GACC,SAAS,OAAO,QAAQ,UAAU;GAClC,4BAA4B,eAAe;EAC3C,GACD,kBACA;AAED,SAAO,EACN,cAAc,qBAAqB,iBAAiB,IAAI,CAAC,UAAU;GAClE,UAAU,KAAK;GACf,aAAa;IACZ,OAAO;KACN,QAAQ,KAAK,gBAAgB;KAC7B,WAAW,KAAK,gBAAgB;KAChC,UAAU,KAAK,gBAAgB;KAC/B,iBAAiB,KAAK,gBAAgB;IACtC;IACD,WAAW,KAAK,gBAAgB;IAChC,SAAS,KAAK,gBAAgB;IAC9B,WAAW,KAAK,gBAAgB;IAChC,UAAU,KAAK,gBAAgB;GAC/B;EACD,GAAE,CACH;CACD;AAED,KAAI,OAAO,aAAa,OAAO,SAAS,UAAU,QACjD,KAAI;EACH,MAAM,oBAAoB;GACzB,SAAS,OAAO;GAChB,gBAAgB,OAAO,QAAQ,aAAa;GAC5C,iBAAiB,OAAO;GAClB;GACN,iBAAiB;GACjB,WAAW;EACX;EAED,MAAM,WAAW,MAAM,cAAc,mBAAmB,QAAQ,KAAK;EACrE,MAAMC,eAAmC,SAAS,SAAS,IAC1D,CAAC,YAAY;AACZ,QAAK,QAAQ,cACZ,OAAM,IAAI,MAAM;AACjB,UAAO,EACN,UAAU;IACT,SAAS,QAAQ,WAAW;IAC5B,YAAY,QAAQ,cAAc;IAClC,OAAO,QAAQ,cAAc;IAC7B,MAAM,QAAQ,cAAc;IAC5B,aAAa,QAAQ,cAAc;IACnC,OAAO,QAAQ,cAAc;IAC7B,OAAO,QAAQ,cAAc;GAC7B,EACD;EACD,EACD;AACD,SAAO;GACQ;GAEd,MAAM,SAAS;EACf;CACD,SAAQ,OAAO;AAEf,UAAQ,MAAM,MAAM;CACpB;AAGF,QAAO,MAAM,kBAAkB,iBAAiB,QAAQ;AACxD;AAOD,SAAgB,6BACfC,QACC;CACD,MAAM,UAAU,QACf,OAAO,qBACN,OAAO,WACP,OAAO,QACP,OAAO,WACN,OAAO,OAAO,WAAW,MAC3B;AAED,QAAO,qBAAqB;EAC3B,UAAU,CAAC,GAAG,gBAAgB,OAAO,MAAO;EAC5C,SAAS,OAAO,EAAE,WAAW,KAAK;GACjC,MAAM,oBAAoB,MAAM,uBAAuB,EAEtD,QAAQ,OAAO,OACf,EAAC;AACF,UAAO,sBACN;IAEC,SAAS,OAAO;IAEhB,mBAAmB,OAAO;IAE1B,QAAQ,OAAO;IAEf,MAAM,OAAO;IACb,QAAQ,OAAO;IACf,WAAW,OAAO;IAClB,iBAAiB,OAAO;GACxB,GACD,mBACA,UACA;EACD;EACD,kBAAkB;GAAE,MAAM;GAAG,UAAU;EAAI;EAC3C,kBAAkB,CAAC,aAClB,SAAS,MAAM,OAAO,SAAS;EAChC,GAAG,OAAO;EACV;CACA,EAAC;AACF"}