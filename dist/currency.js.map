{"version":3,"file":"currency.js","names":["currency"],"sources":["../src/react/queries/currency/list.ts","../src/react/queries/currency/convert-to-usd.ts","../src/react/queries/currency/compare-prices.ts","../src/react/queries/currency/currency.ts"],"sourcesContent":["import type {\n\tAddress,\n\tCurrency,\n\tListCurrenciesRequest,\n} from '@0xsequence/api-client';\nimport { zeroAddress } from 'viem';\nimport { compareAddress, findMarketCollection } from '../../../utils';\nimport {\n\tbuildQueryOptions,\n\tgetMarketplaceClient,\n\tgetQueryClient,\n\ttype SdkQueryParams,\n\ttype WithOptionalParams,\n\ttype WithRequired,\n} from '../../_internal';\nimport { marketplaceConfigOptions } from '../marketplace/config';\n\nexport type FetchMarketCurrenciesParams = ListCurrenciesRequest & {\n\tincludeNativeCurrency?: boolean;\n\tcollectionAddress?: Address;\n};\n\nexport type MarketCurrenciesQueryOptions =\n\tSdkQueryParams<FetchMarketCurrenciesParams>;\n\n/**\n * Fetches supported currencies for a marketplace\n */\nexport async function fetchMarketCurrencies(\n\tparams: WithRequired<MarketCurrenciesQueryOptions, 'chainId' | 'config'>,\n): Promise<Currency[]> {\n\tconst { chainId, includeNativeCurrency, collectionAddress, config } = params;\n\tconst includeNativeCurrencyOption = includeNativeCurrency ?? true;\n\tconst marketplaceClient = getMarketplaceClient(config);\n\n\tlet currencies = await marketplaceClient\n\t\t.listCurrencies({\n\t\t\tchainId,\n\t\t})\n\t\t.then((resp) =>\n\t\t\tresp.currencies.map((currency) => ({\n\t\t\t\t...currency,\n\t\t\t\tcontractAddress: currency.contractAddress || zeroAddress,\n\t\t\t})),\n\t\t);\n\n\tif (collectionAddress) {\n\t\tconst queryClient = getQueryClient();\n\t\tconst marketplaceConfig = await queryClient.fetchQuery(\n\t\t\tmarketplaceConfigOptions(config),\n\t\t);\n\n\t\tconst currenciesOptions = findMarketCollection(\n\t\t\tmarketplaceConfig.market.collections,\n\t\t\tcollectionAddress,\n\t\t\tchainId,\n\t\t)?.currencyOptions;\n\n\t\t// Filter currencies based on collection currency options\n\t\tif (currenciesOptions) {\n\t\t\tcurrencies = currencies.filter((currency) =>\n\t\t\t\tcurrenciesOptions.some((option) =>\n\t\t\t\t\tcompareAddress(option, currency.contractAddress),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t}\n\n\tif (!includeNativeCurrencyOption) {\n\t\tcurrencies = currencies.filter((currency) => !currency.nativeCurrency);\n\t}\n\n\treturn currencies;\n}\n\nexport function getMarketCurrenciesQueryKey(\n\tparams: MarketCurrenciesQueryOptions,\n) {\n\treturn [\n\t\t'currency',\n\t\t'list',\n\t\t{\n\t\t\tchainId: params.chainId,\n\t\t\tincludeNativeCurrency: params.includeNativeCurrency,\n\t\t\tcollectionAddress: params.collectionAddress,\n\t\t},\n\t] as const;\n}\n\nexport function marketCurrenciesQueryOptions(\n\tparams: WithOptionalParams<\n\t\tWithRequired<MarketCurrenciesQueryOptions, 'chainId' | 'config'>\n\t>,\n) {\n\treturn buildQueryOptions(\n\t\t{\n\t\t\tgetQueryKey: getMarketCurrenciesQueryKey,\n\t\t\trequiredParams: ['chainId', 'config'] as const,\n\t\t\tfetcher: fetchMarketCurrencies,\n\t\t},\n\t\tparams,\n\t);\n}\n","import type { Address, ChainId } from '@0xsequence/api-client';\nimport { formatUnits } from 'viem';\nimport {\n\tbuildQueryOptions,\n\ttype Currency,\n\tgetQueryClient,\n\ttype SdkQueryParams,\n\ttype WithOptionalParams,\n\ttype WithRequired,\n} from '../../_internal';\nimport { marketCurrenciesQueryOptions } from './list';\n\nexport type FetchConvertPriceToUSDParams = {\n\tchainId: ChainId;\n\tcurrencyAddress: Address;\n\tamountRaw: string;\n};\n\nexport type ConvertPriceToUSDReturn = {\n\tusdAmount: number;\n\tusdAmountFormatted: string;\n};\n\nexport type ConvertPriceToUSDQueryOptions =\n\tSdkQueryParams<FetchConvertPriceToUSDParams>;\n\n/**\n * Converts a price amount from a specific currency to USD using exchange rates\n */\nexport async function fetchConvertPriceToUSD(\n\tparams: WithRequired<\n\t\tConvertPriceToUSDQueryOptions,\n\t\t'chainId' | 'currencyAddress' | 'amountRaw' | 'config'\n\t>,\n): Promise<ConvertPriceToUSDReturn> {\n\tconst { chainId, currencyAddress, amountRaw, config } = params;\n\n\tconst queryClient = getQueryClient();\n\tconst currencies = await queryClient.fetchQuery(\n\t\tmarketCurrenciesQueryOptions({\n\t\t\tchainId,\n\t\t\tconfig,\n\t\t}),\n\t);\n\n\tconst currencyDetails = currencies.find(\n\t\t(c: Currency) =>\n\t\t\tc.contractAddress.toLowerCase() === currencyAddress.toLowerCase(),\n\t);\n\n\tif (!currencyDetails) {\n\t\tthrow new Error('Currency not found');\n\t}\n\n\tconst amountDecimal = Number(\n\t\tformatUnits(BigInt(amountRaw), currencyDetails.decimals),\n\t);\n\tconst usdAmount = amountDecimal * currencyDetails.exchangeRate;\n\n\treturn {\n\t\tusdAmount,\n\t\tusdAmountFormatted: usdAmount.toFixed(2),\n\t};\n}\n\nexport function getConvertPriceToUSDQueryKey(\n\tparams: ConvertPriceToUSDQueryOptions,\n) {\n\tconst apiArgs = {\n\t\tchainId: params.chainId,\n\t\tcurrencyAddress: params.currencyAddress,\n\t\tamountRaw: params.amountRaw,\n\t};\n\n\treturn ['currency', 'convert-to-usd', apiArgs] as const;\n}\n\nexport function convertPriceToUSDQueryOptions(\n\tparams: WithOptionalParams<\n\t\tWithRequired<\n\t\t\tConvertPriceToUSDQueryOptions,\n\t\t\t'chainId' | 'currencyAddress' | 'amountRaw' | 'config'\n\t\t>\n\t>,\n) {\n\treturn buildQueryOptions(\n\t\t{\n\t\t\tgetQueryKey: getConvertPriceToUSDQueryKey,\n\t\t\trequiredParams: [\n\t\t\t\t'chainId',\n\t\t\t\t'currencyAddress',\n\t\t\t\t'amountRaw',\n\t\t\t\t'config',\n\t\t\t] as const,\n\t\t\tfetcher: fetchConvertPriceToUSD,\n\t\t},\n\t\tparams,\n\t);\n}\n","import type { Address, ChainId } from '@0xsequence/api-client';\nimport {\n\tbuildQueryOptions,\n\ttype SdkQueryParams,\n\ttype WithOptionalParams,\n\ttype WithRequired,\n} from '../../_internal';\nimport { fetchConvertPriceToUSD } from './convert-to-usd';\n\nexport type FetchComparePricesParams = {\n\tchainId?: ChainId;\n\tpriceAmountRaw?: string;\n\tpriceCurrencyAddress?: Address;\n\tcompareToPriceAmountRaw?: string;\n\tcompareToPriceCurrencyAddress?: Address;\n};\n\nexport type ComparePricesReturn = {\n\tpercentageDifference: number;\n\tpercentageDifferenceFormatted: string;\n\tstatus: 'above' | 'same' | 'below';\n};\n\nexport type ComparePricesQueryOptions =\n\tSdkQueryParams<FetchComparePricesParams>;\n\n/**\n * Compares prices between different currencies by converting both to USD\n */\nexport async function fetchComparePrices(\n\tparams: WithRequired<\n\t\tComparePricesQueryOptions,\n\t\t| 'chainId'\n\t\t| 'priceAmountRaw'\n\t\t| 'priceCurrencyAddress'\n\t\t| 'compareToPriceAmountRaw'\n\t\t| 'compareToPriceCurrencyAddress'\n\t\t| 'config'\n\t>,\n): Promise<ComparePricesReturn> {\n\tconst {\n\t\tchainId,\n\t\tpriceAmountRaw,\n\t\tpriceCurrencyAddress,\n\t\tcompareToPriceAmountRaw,\n\t\tcompareToPriceCurrencyAddress,\n\t\tconfig,\n\t} = params;\n\n\tconst [priceUSD, compareToPriceUSD] = await Promise.all([\n\t\tfetchConvertPriceToUSD({\n\t\t\tchainId,\n\t\t\tcurrencyAddress: priceCurrencyAddress,\n\t\t\tamountRaw: priceAmountRaw,\n\t\t\tconfig,\n\t\t}),\n\t\tfetchConvertPriceToUSD({\n\t\t\tchainId,\n\t\t\tcurrencyAddress: compareToPriceCurrencyAddress,\n\t\t\tamountRaw: compareToPriceAmountRaw,\n\t\t\tconfig,\n\t\t}),\n\t]);\n\n\tconst difference = priceUSD.usdAmount - compareToPriceUSD.usdAmount;\n\n\tif (compareToPriceUSD.usdAmount === 0) {\n\t\tthrow new Error('Cannot compare to zero price');\n\t}\n\n\tconst percentageDifference = (difference / compareToPriceUSD.usdAmount) * 100;\n\tconst isAbove = percentageDifference > 0;\n\tconst isSame = percentageDifference === 0;\n\n\treturn {\n\t\tpercentageDifference,\n\t\tpercentageDifferenceFormatted: Math.abs(percentageDifference).toFixed(2),\n\t\tstatus: isAbove ? 'above' : isSame ? 'same' : 'below',\n\t};\n}\n\nexport function getComparePricesQueryKey(params: ComparePricesQueryOptions) {\n\tconst apiArgs = {\n\t\tchainId: params.chainId,\n\t\tpriceAmountRaw: params.priceAmountRaw,\n\t\tpriceCurrencyAddress: params.priceCurrencyAddress,\n\t\tcompareToPriceAmountRaw: params.compareToPriceAmountRaw,\n\t\tcompareToPriceCurrencyAddress: params.compareToPriceCurrencyAddress,\n\t};\n\n\treturn ['currency', 'compare-prices', apiArgs] as const;\n}\n\nexport function comparePricesQueryOptions(\n\tparams: WithOptionalParams<\n\t\tWithRequired<\n\t\t\tComparePricesQueryOptions,\n\t\t\t| 'chainId'\n\t\t\t| 'priceAmountRaw'\n\t\t\t| 'priceCurrencyAddress'\n\t\t\t| 'compareToPriceAmountRaw'\n\t\t\t| 'compareToPriceCurrencyAddress'\n\t\t\t| 'config'\n\t\t>\n\t>,\n) {\n\treturn buildQueryOptions(\n\t\t{\n\t\t\tgetQueryKey: getComparePricesQueryKey,\n\t\t\trequiredParams: [\n\t\t\t\t'chainId',\n\t\t\t\t'priceAmountRaw',\n\t\t\t\t'priceCurrencyAddress',\n\t\t\t\t'compareToPriceAmountRaw',\n\t\t\t\t'compareToPriceCurrencyAddress',\n\t\t\t\t'config',\n\t\t\t] as const,\n\t\t\tfetcher: fetchComparePrices,\n\t\t},\n\t\tparams,\n\t);\n}\n","import type { Address, ListCurrenciesRequest } from '@0xsequence/api-client';\nimport { isAddress } from 'viem';\nimport {\n\tbuildQueryOptions,\n\ttype Currency,\n\tgetMarketplaceClient,\n\tgetQueryClient,\n\ttype SdkQueryParams,\n\ttype WithOptionalParams,\n\ttype WithRequired,\n} from '../../_internal';\n\nexport type FetchCurrencyParams = ListCurrenciesRequest & {\n\tcurrencyAddress: Address;\n};\n\n/**\n * Fetches currency details from the marketplace API\n */\nexport async function fetchCurrency(\n\tparams: WithRequired<\n\t\tCurrencyQueryOptions,\n\t\t'chainId' | 'currencyAddress' | 'config'\n\t>,\n): Promise<Currency | undefined> {\n\tconst { chainId, currencyAddress, config } = params;\n\tconst queryClient = getQueryClient();\n\n\tlet currencies = queryClient.getQueryData<Currency[]>([\n\t\t'currency',\n\t\t'list',\n\t\tchainId,\n\t]);\n\n\tif (!currencies) {\n\t\tconst marketplaceClient = getMarketplaceClient(config);\n\t\tconst response = await marketplaceClient.listCurrencies({ chainId });\n\t\tcurrencies = response.currencies;\n\t}\n\n\tif (!currencies?.length) {\n\t\tthrow new Error('No currencies returned');\n\t}\n\tconst currency = currencies.find(\n\t\t(currency) =>\n\t\t\tcurrency.contractAddress.toLowerCase() === currencyAddress.toLowerCase(),\n\t);\n\n\tif (!currency) {\n\t\tthrow new Error('Currency not found');\n\t}\n\n\treturn currency;\n}\n\nexport type CurrencyQueryOptions = SdkQueryParams<FetchCurrencyParams>;\n\nexport function getCurrencyQueryKey(params: CurrencyQueryOptions) {\n\tconst apiArgs = {\n\t\tchainId: String(params.chainId ?? 0),\n\t\tcurrencyAddress: params.currencyAddress ?? '',\n\t};\n\n\treturn ['currency', 'currency', apiArgs] as const;\n}\n\nexport function currencyQueryOptions(\n\tparams: WithOptionalParams<\n\t\tWithRequired<CurrencyQueryOptions, 'chainId' | 'currencyAddress' | 'config'>\n\t>,\n) {\n\treturn buildQueryOptions(\n\t\t{\n\t\t\tgetQueryKey: getCurrencyQueryKey,\n\t\t\trequiredParams: ['chainId', 'currencyAddress', 'config'] as const,\n\t\t\tfetcher: fetchCurrency,\n\t\t\tcustomValidation: (p) =>\n\t\t\t\t!!p.currencyAddress && isAddress(p.currencyAddress),\n\t\t},\n\t\tparams,\n\t);\n}\n"],"mappings":";;;;;;;;;;AA4BA,eAAsB,sBACrB,QACsB;CACtB,MAAM,EAAE,SAAS,uBAAuB,mBAAmB,WAAW;CACtE,MAAM,8BAA8B,yBAAyB;CAG7D,IAAI,aAAa,MAFS,qBAAqB,OAAO,CAGpD,eAAe,EACf,SACA,CAAC,CACD,MAAM,SACN,KAAK,WAAW,KAAK,cAAc;EAClC,GAAG;EACH,iBAAiB,SAAS,mBAAmB;EAC7C,EAAE,CACH;AAEF,KAAI,mBAAmB;EAMtB,MAAM,oBAAoB,sBAJA,MADN,gBAAgB,CACQ,WAC3C,yBAAyB,OAAO,CAChC,EAGkB,OAAO,aACzB,mBACA,QACA,EAAE;AAGH,MAAI,kBACH,cAAa,WAAW,QAAQ,aAC/B,kBAAkB,MAAM,WACvB,eAAe,QAAQ,SAAS,gBAAgB,CAChD,CACD;;AAIH,KAAI,CAAC,4BACJ,cAAa,WAAW,QAAQ,aAAa,CAAC,SAAS,eAAe;AAGvE,QAAO;;AAGR,SAAgB,4BACf,QACC;AACD,QAAO;EACN;EACA;EACA;GACC,SAAS,OAAO;GAChB,uBAAuB,OAAO;GAC9B,mBAAmB,OAAO;GAC1B;EACD;;AAGF,SAAgB,6BACf,QAGC;AACD,QAAO,kBACN;EACC,aAAa;EACb,gBAAgB,CAAC,WAAW,SAAS;EACrC,SAAS;EACT,EACD,OACA;;;;;;;;ACxEF,eAAsB,uBACrB,QAImC;CACnC,MAAM,EAAE,SAAS,iBAAiB,WAAW,WAAW;CAUxD,MAAM,mBAPa,MADC,gBAAgB,CACC,WACpC,6BAA6B;EAC5B;EACA;EACA,CAAC,CACF,EAEkC,MACjC,MACA,EAAE,gBAAgB,aAAa,KAAK,gBAAgB,aAAa,CAClE;AAED,KAAI,CAAC,gBACJ,OAAM,IAAI,MAAM,qBAAqB;CAMtC,MAAM,YAHgB,OACrB,YAAY,OAAO,UAAU,EAAE,gBAAgB,SAAS,CACxD,GACiC,gBAAgB;AAElD,QAAO;EACN;EACA,oBAAoB,UAAU,QAAQ,EAAE;EACxC;;AAGF,SAAgB,6BACf,QACC;AAOD,QAAO;EAAC;EAAY;EANJ;GACf,SAAS,OAAO;GAChB,iBAAiB,OAAO;GACxB,WAAW,OAAO;GAClB;EAE6C;;AAG/C,SAAgB,8BACf,QAMC;AACD,QAAO,kBACN;EACC,aAAa;EACb,gBAAgB;GACf;GACA;GACA;GACA;GACA;EACD,SAAS;EACT,EACD,OACA;;;;;;;;ACpEF,eAAsB,mBACrB,QAS+B;CAC/B,MAAM,EACL,SACA,gBACA,sBACA,yBACA,+BACA,WACG;CAEJ,MAAM,CAAC,UAAU,qBAAqB,MAAM,QAAQ,IAAI,CACvD,uBAAuB;EACtB;EACA,iBAAiB;EACjB,WAAW;EACX;EACA,CAAC,EACF,uBAAuB;EACtB;EACA,iBAAiB;EACjB,WAAW;EACX;EACA,CAAC,CACF,CAAC;CAEF,MAAM,aAAa,SAAS,YAAY,kBAAkB;AAE1D,KAAI,kBAAkB,cAAc,EACnC,OAAM,IAAI,MAAM,+BAA+B;CAGhD,MAAM,uBAAwB,aAAa,kBAAkB,YAAa;CAC1E,MAAM,UAAU,uBAAuB;CACvC,MAAM,SAAS,yBAAyB;AAExC,QAAO;EACN;EACA,+BAA+B,KAAK,IAAI,qBAAqB,CAAC,QAAQ,EAAE;EACxE,QAAQ,UAAU,UAAU,SAAS,SAAS;EAC9C;;AAGF,SAAgB,yBAAyB,QAAmC;AAS3E,QAAO;EAAC;EAAY;EARJ;GACf,SAAS,OAAO;GAChB,gBAAgB,OAAO;GACvB,sBAAsB,OAAO;GAC7B,yBAAyB,OAAO;GAChC,+BAA+B,OAAO;GACtC;EAE6C;;AAG/C,SAAgB,0BACf,QAWC;AACD,QAAO,kBACN;EACC,aAAa;EACb,gBAAgB;GACf;GACA;GACA;GACA;GACA;GACA;GACA;EACD,SAAS;EACT,EACD,OACA;;;;;;;;ACrGF,eAAsB,cACrB,QAIgC;CAChC,MAAM,EAAE,SAAS,iBAAiB,WAAW;CAG7C,IAAI,aAFgB,gBAAgB,CAEP,aAAyB;EACrD;EACA;EACA;EACA,CAAC;AAEF,KAAI,CAAC,WAGJ,eADiB,MADS,qBAAqB,OAAO,CACb,eAAe,EAAE,SAAS,CAAC,EAC9C;AAGvB,KAAI,CAAC,YAAY,OAChB,OAAM,IAAI,MAAM,yBAAyB;CAE1C,MAAM,WAAW,WAAW,MAC1B,eACAA,WAAS,gBAAgB,aAAa,KAAK,gBAAgB,aAAa,CACzE;AAED,KAAI,CAAC,SACJ,OAAM,IAAI,MAAM,qBAAqB;AAGtC,QAAO;;AAKR,SAAgB,oBAAoB,QAA8B;AAMjE,QAAO;EAAC;EAAY;EALJ;GACf,SAAS,OAAO,OAAO,WAAW,EAAE;GACpC,iBAAiB,OAAO,mBAAmB;GAC3C;EAEuC;;AAGzC,SAAgB,qBACf,QAGC;AACD,QAAO,kBACN;EACC,aAAa;EACb,gBAAgB;GAAC;GAAW;GAAmB;GAAS;EACxD,SAAS;EACT,mBAAmB,MAClB,CAAC,CAAC,EAAE,mBAAmB,UAAU,EAAE,gBAAgB;EACpD,EACD,OACA"}