{"version":3,"file":"quantityInput.js","names":["dnMaxQuantity","cn"],"sources":["../src/react/ui/modals/_internal/components/quantityInput/index.tsx"],"sourcesContent":["'use client';\n\nimport {\n\tAddIcon,\n\tField,\n\tFieldLabel,\n\tIconButton,\n\tNumericInput,\n\tSubtractIcon,\n} from '@0xsequence/design-system';\nimport * as dn from 'dnum';\nimport { useEffect, useState } from 'react';\nimport { cn } from '../../../../../../utils';\n\ntype QuantityInputProps = {\n\tquantity: bigint;\n\tinvalidQuantity: boolean;\n\tonQuantityChange: (quantity: bigint) => void;\n\tonInvalidQuantityChange: (invalid: boolean) => void;\n\tdecimals?: number;\n\tmaxQuantity: bigint;\n\tclassName?: string;\n\tdisabled?: boolean;\n};\n\nexport default function QuantityInput({\n\tquantity,\n\tinvalidQuantity,\n\tonQuantityChange,\n\tonInvalidQuantityChange,\n\tdecimals = 0,\n\tmaxQuantity,\n\tclassName,\n\tdisabled,\n}: QuantityInputProps) {\n\tconst dnMaxQuantity = dn.from(maxQuantity, decimals);\n\tconst minIncrement = decimals > 0 ? `0.${'1'.padStart(decimals, '0')}` : '1';\n\tconst dnIncrement = dn.from(minIncrement, decimals);\n\tconst min = decimals > 0 ? minIncrement : '1';\n\tconst dnMin = dn.from(min, decimals);\n\n\tconst dnQuantityInitial = dn.from(quantity, decimals);\n\tconst [dnQuantity, setDnQuantity] = useState(dnQuantityInitial);\n\tconst [localQuantity, setLocalQuantity] = useState(\n\t\tdn.toString(dnQuantityInitial, decimals),\n\t);\n\n\t// Sync internal state with external prop changes and validate initial quantity\n\tuseEffect(() => {\n\t\tconst dnInitialQuantity = dn.from(quantity, decimals);\n\t\tconst dnMaxQuantity = dn.from(maxQuantity, decimals);\n\n\t\t// Check if initial quantity exceeds max quantity\n\t\tif (dn.greaterThan(dnInitialQuantity, dnMaxQuantity)) {\n\t\t\t// If initial quantity is too high, set it to max quantity\n\t\t\tconst validQuantity = dn.toString(dnMaxQuantity, decimals);\n\t\t\tsetLocalQuantity(validQuantity);\n\t\t\tsetDnQuantity(dnMaxQuantity);\n\t\t\tonQuantityChange(dnMaxQuantity[0]);\n\t\t\tonInvalidQuantityChange(false);\n\t\t} else {\n\t\t\tsetLocalQuantity(dn.toString(dnInitialQuantity, decimals));\n\t\t\tsetDnQuantity(dnInitialQuantity);\n\t\t}\n\t}, [\n\t\tquantity,\n\t\tdecimals,\n\t\tmaxQuantity,\n\t\tonQuantityChange,\n\t\tonInvalidQuantityChange,\n\t]);\n\n\tconst setValidQuantity = (value: dn.Dnum) => {\n\t\tconst valueStr = dn.toString(value, decimals);\n\t\tsetLocalQuantity(valueStr);\n\t\tsetDnQuantity(value);\n\t\tonQuantityChange(value[0]);\n\t\tonInvalidQuantityChange(false);\n\t};\n\n\tfunction handleChangeQuantity(value: string) {\n\t\tif (!value || Number.isNaN(Number(value)) || value.endsWith('.')) {\n\t\t\tsetLocalQuantity(value);\n\t\t\tonInvalidQuantityChange(true);\n\t\t\treturn;\n\t\t}\n\t\tconst dnValue = dn.from(value, decimals);\n\t\tconst isBiggerThanMax = dn.greaterThan(dnValue, dnMaxQuantity);\n\t\tconst isLessThanMin = dn.lessThan(dnValue, dnMin);\n\n\t\tif (isLessThanMin) {\n\t\t\tsetLocalQuantity(value); // Trying to enter fraction starting with 0\n\t\t\tonInvalidQuantityChange(true);\n\t\t\treturn;\n\t\t}\n\n\t\tif (isBiggerThanMax) {\n\t\t\tsetValidQuantity(dnMaxQuantity); // Value capped at max quantity\n\t\t\treturn;\n\t\t}\n\n\t\tsetValidQuantity(dnValue);\n\t}\n\n\tfunction handleIncrement() {\n\t\tconst newValue = dn.add(dnQuantity, dnIncrement);\n\t\tif (dn.greaterThanOrEqual(newValue, dnMaxQuantity)) {\n\t\t\tsetValidQuantity(dnMaxQuantity);\n\t\t} else {\n\t\t\tsetValidQuantity(newValue);\n\t\t}\n\t}\n\n\tfunction handleDecrement() {\n\t\tconst newValue = dn.subtract(dnQuantity, dnIncrement);\n\t\tif (dn.lessThanOrEqual(newValue, dnMin)) {\n\t\t\tsetValidQuantity(dnMin);\n\t\t} else {\n\t\t\tsetValidQuantity(newValue);\n\t\t}\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t'flex w-full flex-col',\n\t\t\t\tclassName,\n\t\t\t\tdisabled && 'pointer-events-none opacity-50',\n\t\t\t)}\n\t\t>\n\t\t\t<Field>\n\t\t\t\t<FieldLabel htmlFor=\"quantity\" className=\"text-xs\">\n\t\t\t\t\tEnter quantity\n\t\t\t\t</FieldLabel>\n\n\t\t\t\t<NumericInput\n\t\t\t\t\taria-label=\"Enter quantity\"\n\t\t\t\t\tclassName=\"h-9 w-full rounded pr-0 [&>div]:pr-2 [&>input]:text-xs\"\n\t\t\t\t\tname={'quantity'}\n\t\t\t\t\tdecimals={decimals || 0}\n\t\t\t\t\tcontrols={\n\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisabled={dn.lessThanOrEqual(dnQuantity, dnMin)}\n\t\t\t\t\t\t\t\tonClick={handleDecrement}\n\t\t\t\t\t\t\t\tsize=\"xs\"\n\t\t\t\t\t\t\t\ticon={SubtractIcon}\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisabled={dn.greaterThanOrEqual(dnQuantity, dnMaxQuantity)}\n\t\t\t\t\t\t\t\tonClick={handleIncrement}\n\t\t\t\t\t\t\t\tsize=\"xs\"\n\t\t\t\t\t\t\t\ticon={AddIcon}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t}\n\t\t\t\t\tvalue={localQuantity}\n\t\t\t\t\tonChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n\t\t\t\t\t\thandleChangeQuantity(e.target.value)\n\t\t\t\t\t}\n\t\t\t\t\twidth={'full'}\n\t\t\t\t/>\n\t\t\t</Field>\n\n\t\t\t{invalidQuantity && (\n\t\t\t\t<div className=\"mt-1.5 font-medium text-amber-500 text-xs\">\n\t\t\t\t\tInvalid quantity\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n"],"mappings":";;;;;;;AAyBA,SAAwB,cAAc,EACrC,UACA,iBACA,kBACA,yBACA,WAAW,GACX,aACA,WACA,YACsB;CACtB,MAAM,gBAAgB,GAAG,KAAK,aAAa,SAAS;CACpD,MAAM,eAAe,WAAW,IAAI,KAAK,IAAI,SAAS,UAAU,IAAI,KAAK;CACzE,MAAM,cAAc,GAAG,KAAK,cAAc,SAAS;CACnD,MAAM,MAAM,WAAW,IAAI,eAAe;CAC1C,MAAM,QAAQ,GAAG,KAAK,KAAK,SAAS;CAEpC,MAAM,oBAAoB,GAAG,KAAK,UAAU,SAAS;CACrD,MAAM,CAAC,YAAY,iBAAiB,SAAS,kBAAkB;CAC/D,MAAM,CAAC,eAAe,oBAAoB,SACzC,GAAG,SAAS,mBAAmB,SAAS,CACxC;AAGD,iBAAgB;EACf,MAAM,oBAAoB,GAAG,KAAK,UAAU,SAAS;EACrD,MAAMA,kBAAgB,GAAG,KAAK,aAAa,SAAS;AAGpD,MAAI,GAAG,YAAY,mBAAmBA,gBAAc,EAAE;AAGrD,oBADsB,GAAG,SAASA,iBAAe,SAAS,CAC3B;AAC/B,iBAAcA,gBAAc;AAC5B,oBAAiBA,gBAAc,GAAG;AAClC,2BAAwB,MAAM;SACxB;AACN,oBAAiB,GAAG,SAAS,mBAAmB,SAAS,CAAC;AAC1D,iBAAc,kBAAkB;;IAE/B;EACF;EACA;EACA;EACA;EACA;EACA,CAAC;CAEF,MAAM,oBAAoB,UAAmB;AAE5C,mBADiB,GAAG,SAAS,OAAO,SAAS,CACnB;AAC1B,gBAAc,MAAM;AACpB,mBAAiB,MAAM,GAAG;AAC1B,0BAAwB,MAAM;;CAG/B,SAAS,qBAAqB,OAAe;AAC5C,MAAI,CAAC,SAAS,OAAO,MAAM,OAAO,MAAM,CAAC,IAAI,MAAM,SAAS,IAAI,EAAE;AACjE,oBAAiB,MAAM;AACvB,2BAAwB,KAAK;AAC7B;;EAED,MAAM,UAAU,GAAG,KAAK,OAAO,SAAS;EACxC,MAAM,kBAAkB,GAAG,YAAY,SAAS,cAAc;AAG9D,MAFsB,GAAG,SAAS,SAAS,MAAM,EAE9B;AAClB,oBAAiB,MAAM;AACvB,2BAAwB,KAAK;AAC7B;;AAGD,MAAI,iBAAiB;AACpB,oBAAiB,cAAc;AAC/B;;AAGD,mBAAiB,QAAQ;;CAG1B,SAAS,kBAAkB;EAC1B,MAAM,WAAW,GAAG,IAAI,YAAY,YAAY;AAChD,MAAI,GAAG,mBAAmB,UAAU,cAAc,CACjD,kBAAiB,cAAc;MAE/B,kBAAiB,SAAS;;CAI5B,SAAS,kBAAkB;EAC1B,MAAM,WAAW,GAAG,SAAS,YAAY,YAAY;AACrD,MAAI,GAAG,gBAAgB,UAAU,MAAM,CACtC,kBAAiB,MAAM;MAEvB,kBAAiB,SAAS;;AAI5B,QACC,qBAAC;EACA,WAAWC,KACV,wBACA,WACA,YAAY,iCACZ;aAED,qBAAC,oBACA,oBAAC;GAAW,SAAQ;GAAW,WAAU;aAAU;IAEtC,EAEb,oBAAC;GACA,cAAW;GACX,WAAU;GACV,MAAM;GACN,UAAU,YAAY;GACtB,UACC,qBAAC;IAAI,WAAU;eACd,oBAAC;KACA,UAAU,GAAG,gBAAgB,YAAY,MAAM;KAC/C,SAAS;KACT,MAAK;KACL,MAAM;MACL,EAEF,oBAAC;KACA,UAAU,GAAG,mBAAmB,YAAY,cAAc;KAC1D,SAAS;KACT,MAAK;KACL,MAAM;MACL;KACG;GAEP,OAAO;GACP,WAAW,MACV,qBAAqB,EAAE,OAAO,MAAM;GAErC,OAAO;IACN,IACK,EAEP,mBACA,oBAAC;GAAI,WAAU;aAA4C;IAErD;GAEF"}