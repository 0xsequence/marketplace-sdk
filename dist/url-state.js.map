{"version":3,"file":"url-state.js","names":["newPriceFilter: PriceFilter"],"sources":["../src/react/hooks/ui/url-state/filter-state.tsx"],"sourcesContent":["import {\n\tcreateSerializer,\n\tparseAsBoolean,\n\tparseAsJson,\n\tparseAsString,\n\tuseQueryState,\n} from 'nuqs';\nimport { useMemo } from 'react';\nimport {\n\ttype PriceFilter,\n\ttype PropertyFilter,\n\tPropertyType,\n} from '../../../_internal';\n\ninterface StringFilterValues {\n\ttype: PropertyType.STRING;\n\tvalues: string[];\n}\n\ninterface IntFilterValues {\n\ttype: PropertyType.INT;\n\tmin: number;\n\tmax: number;\n}\n\ntype FilterValues = StringFilterValues | IntFilterValues;\n\nconst validateFilters = (value: unknown): PropertyFilter[] => {\n\tif (!Array.isArray(value)) return [];\n\treturn value.filter(\n\t\t(f): f is PropertyFilter =>\n\t\t\ttypeof f === 'object' &&\n\t\t\ttypeof f.name === 'string' &&\n\t\t\tObject.values(PropertyType).includes(f.type),\n\t);\n};\n\nconst validatePriceFilters = (value: unknown): PriceFilter[] => {\n\tif (!Array.isArray(value)) return [];\n\treturn value.filter(\n\t\t(f): f is PriceFilter =>\n\t\t\ttypeof f === 'object' &&\n\t\t\ttypeof f.contractAddress === 'string' &&\n\t\t\t(f.min === undefined || typeof f.min === 'string') &&\n\t\t\t(f.max === undefined || typeof f.max === 'string'),\n\t);\n};\n\nconst filtersParser = parseAsJson(validateFilters).withDefault([]);\nconst searchParser = parseAsString.withDefault('');\nconst listedOnlyParser = parseAsBoolean.withDefault(false);\nconst priceFilterParser = parseAsBoolean.withDefault(false);\nconst priceFiltersParser = parseAsJson(validatePriceFilters).withDefault([]);\n\nconst serialize = createSerializer(\n\t{\n\t\tfilters: filtersParser,\n\t\tsearch: searchParser,\n\t\tlistedOnly: listedOnlyParser,\n\t\tpriceFilter: priceFilterParser,\n\t\tpriceFilters: priceFiltersParser,\n\t},\n\t{\n\t\turlKeys: {\n\t\t\tfilters: 'f',\n\t\t\tsearch: 'q',\n\t\t\tlistedOnly: 'l',\n\t\t\tpriceFilter: 'p',\n\t\t\tpriceFilters: 'pf',\n\t\t},\n\t},\n);\n\nexport function useFilterState() {\n\tconst [filterOptions, setFilterOptions] = useQueryState(\n\t\t'filters',\n\t\tfiltersParser,\n\t);\n\tconst [searchText, setSearchText] = useQueryState('search', searchParser);\n\tconst [showListedOnly, setShowListedOnly] = useQueryState(\n\t\t'listedOnly',\n\t\tlistedOnlyParser,\n\t);\n\tconst [showPriceFilter, setShowPriceFilter] = useQueryState(\n\t\t'priceFilter',\n\t\tpriceFilterParser,\n\t);\n\tconst [priceFilters, setPriceFilters] = useQueryState(\n\t\t'priceFilters',\n\t\tpriceFiltersParser,\n\t);\n\n\tconst helpers = useMemo(\n\t\t() => ({\n\t\t\tgetFilter: (name: string): PropertyFilter | undefined => {\n\t\t\t\treturn filterOptions?.find((f) => f.name === name);\n\t\t\t},\n\n\t\t\tgetFilterValues: (name: string): FilterValues | undefined => {\n\t\t\t\tconst filter = filterOptions?.find((f) => f.name === name);\n\t\t\t\tif (!filter) return undefined;\n\n\t\t\t\tif (filter.type === PropertyType.INT) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: PropertyType.INT,\n\t\t\t\t\t\tmin: filter.min ?? 0,\n\t\t\t\t\t\tmax: filter.max ?? 0,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\ttype: PropertyType.STRING,\n\t\t\t\t\tvalues: (filter.values as string[]) ?? [],\n\t\t\t\t};\n\t\t\t},\n\n\t\t\tisFilterActive: (name: string): boolean => {\n\t\t\t\treturn !!filterOptions?.find((f) => f.name === name);\n\t\t\t},\n\n\t\t\tisStringValueSelected: (name: string, value: string): boolean => {\n\t\t\t\tconst filter = filterOptions?.find((f) => f.name === name);\n\t\t\t\tif (!filter || filter.type !== PropertyType.STRING) return false;\n\t\t\t\treturn (filter.values as string[])?.includes(value) ?? false;\n\t\t\t},\n\n\t\t\tisIntFilterActive: (name: string): boolean => {\n\t\t\t\tconst filter = filterOptions?.find((f) => f.name === name);\n\t\t\t\treturn !!filter && filter.type === PropertyType.INT;\n\t\t\t},\n\n\t\t\tgetIntFilterRange: (name: string): [number, number] | undefined => {\n\t\t\t\tconst filter = filterOptions?.find((f) => f.name === name);\n\t\t\t\tif (!filter || filter.type !== PropertyType.INT) return undefined;\n\t\t\t\treturn [filter.min ?? 0, filter.max ?? 0];\n\t\t\t},\n\n\t\t\tdeleteFilter: (name: string) => {\n\t\t\t\tconst otherFilters =\n\t\t\t\t\tfilterOptions?.filter((f) => !(f.name === name)) ?? [];\n\t\t\t\tsetFilterOptions(otherFilters);\n\t\t\t},\n\n\t\t\ttoggleStringFilterValue: (name: string, value: string) => {\n\t\t\t\tconst otherFilters =\n\t\t\t\t\tfilterOptions?.filter((f) => !(f.name === name)) ?? [];\n\t\t\t\tconst filter = filterOptions?.find((f) => f.name === name);\n\t\t\t\tconst existingValues =\n\t\t\t\t\tfilter?.type === PropertyType.STRING\n\t\t\t\t\t\t? ((filter.values as string[]) ?? [])\n\t\t\t\t\t\t: [];\n\n\t\t\t\tif (existingValues.includes(value)) {\n\t\t\t\t\tconst newValues = existingValues.filter((v) => v !== value);\n\t\t\t\t\tif (newValues.length === 0) {\n\t\t\t\t\t\tsetFilterOptions(otherFilters);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tsetFilterOptions([\n\t\t\t\t\t\t...otherFilters,\n\t\t\t\t\t\t{ name, type: PropertyType.STRING, values: newValues },\n\t\t\t\t\t]);\n\t\t\t\t} else {\n\t\t\t\t\tsetFilterOptions([\n\t\t\t\t\t\t...otherFilters,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\ttype: PropertyType.STRING,\n\t\t\t\t\t\t\tvalues: [...existingValues, value],\n\t\t\t\t\t\t},\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tsetIntFilterValue: (name: string, min: number, max: number) => {\n\t\t\t\tif (min === max && min === 0) {\n\t\t\t\t\tconst otherFilters =\n\t\t\t\t\t\tfilterOptions?.filter((f) => !(f.name === name)) ?? [];\n\t\t\t\t\tsetFilterOptions(otherFilters);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst otherFilters =\n\t\t\t\t\tfilterOptions?.filter((f) => !(f.name === name)) ?? [];\n\t\t\t\tsetFilterOptions([\n\t\t\t\t\t...otherFilters,\n\t\t\t\t\t{ name, type: PropertyType.INT, min, max },\n\t\t\t\t]);\n\t\t\t},\n\n\t\t\tsetPriceFilter: (contractAddress: string, min?: string, max?: string) => {\n\t\t\t\tconst otherPriceFilters =\n\t\t\t\t\tpriceFilters?.filter((f) => f.contractAddress !== contractAddress) ??\n\t\t\t\t\t[];\n\n\t\t\t\tif (!min && !max) {\n\t\t\t\t\tsetPriceFilters(otherPriceFilters);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPriceFilter: PriceFilter = {\n\t\t\t\t\tcontractAddress,\n\t\t\t\t\t...(min && { min: BigInt(min) }),\n\t\t\t\t\t...(max && { max: BigInt(max) }),\n\t\t\t\t};\n\n\t\t\t\tsetPriceFilters([...otherPriceFilters, newPriceFilter]);\n\t\t\t},\n\n\t\t\tgetPriceFilter: (contractAddress: string): PriceFilter | undefined => {\n\t\t\t\treturn priceFilters?.find((f) => f.contractAddress === contractAddress);\n\t\t\t},\n\n\t\t\tclearPriceFilters: () => {\n\t\t\t\tsetPriceFilters([]);\n\t\t\t},\n\n\t\t\tclearAllFilters: () => {\n\t\t\t\tvoid setShowListedOnly(false);\n\t\t\t\tvoid setShowPriceFilter(false);\n\t\t\t\tvoid setFilterOptions([]);\n\t\t\t\tvoid setSearchText('');\n\t\t\t\tvoid setPriceFilters([]);\n\t\t\t},\n\t\t}),\n\t\t[\n\t\t\tfilterOptions,\n\t\t\tsetFilterOptions,\n\t\t\tsetShowListedOnly,\n\t\t\tsetSearchText,\n\t\t\tsetShowPriceFilter,\n\t\t\tpriceFilters,\n\t\t\tsetPriceFilters,\n\t\t],\n\t);\n\n\treturn {\n\t\tfilterOptions,\n\t\tsearchText,\n\t\tshowListedOnly,\n\t\tshowPriceFilter,\n\t\tpriceFilters,\n\t\tsetFilterOptions,\n\t\tsetSearchText,\n\t\tsetShowListedOnly,\n\t\tsetShowPriceFilter,\n\t\tsetPriceFilters,\n\t\t...helpers,\n\t\tserialize,\n\t};\n}\n"],"mappings":";;;;;AA2BA,MAAM,mBAAmB,UAAqC;AAC7D,KAAI,CAAC,MAAM,QAAQ,MAAM,CAAE,QAAO,EAAE;AACpC,QAAO,MAAM,QACX,MACA,OAAO,MAAM,YACb,OAAO,EAAE,SAAS,YAClB,OAAO,OAAO,aAAa,CAAC,SAAS,EAAE,KAAK,CAC7C;;AAGF,MAAM,wBAAwB,UAAkC;AAC/D,KAAI,CAAC,MAAM,QAAQ,MAAM,CAAE,QAAO,EAAE;AACpC,QAAO,MAAM,QACX,MACA,OAAO,MAAM,YACb,OAAO,EAAE,oBAAoB,aAC5B,EAAE,QAAQ,UAAa,OAAO,EAAE,QAAQ,cACxC,EAAE,QAAQ,UAAa,OAAO,EAAE,QAAQ,UAC1C;;AAGF,MAAM,gBAAgB,YAAY,gBAAgB,CAAC,YAAY,EAAE,CAAC;AAClE,MAAM,eAAe,cAAc,YAAY,GAAG;AAClD,MAAM,mBAAmB,eAAe,YAAY,MAAM;AAC1D,MAAM,oBAAoB,eAAe,YAAY,MAAM;AAC3D,MAAM,qBAAqB,YAAY,qBAAqB,CAAC,YAAY,EAAE,CAAC;AAE5E,MAAM,YAAY,iBACjB;CACC,SAAS;CACT,QAAQ;CACR,YAAY;CACZ,aAAa;CACb,cAAc;CACd,EACD,EACC,SAAS;CACR,SAAS;CACT,QAAQ;CACR,YAAY;CACZ,aAAa;CACb,cAAc;CACd,EACD,CACD;AAED,SAAgB,iBAAiB;CAChC,MAAM,CAAC,eAAe,oBAAoB,cACzC,WACA,cACA;CACD,MAAM,CAAC,YAAY,iBAAiB,cAAc,UAAU,aAAa;CACzE,MAAM,CAAC,gBAAgB,qBAAqB,cAC3C,cACA,iBACA;CACD,MAAM,CAAC,iBAAiB,sBAAsB,cAC7C,eACA,kBACA;CACD,MAAM,CAAC,cAAc,mBAAmB,cACvC,gBACA,mBACA;AAiJD,QAAO;EACN;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,GA1Je,eACR;GACN,YAAY,SAA6C;AACxD,WAAO,eAAe,MAAM,MAAM,EAAE,SAAS,KAAK;;GAGnD,kBAAkB,SAA2C;IAC5D,MAAM,SAAS,eAAe,MAAM,MAAM,EAAE,SAAS,KAAK;AAC1D,QAAI,CAAC,OAAQ,QAAO;AAEpB,QAAI,OAAO,SAAS,aAAa,IAChC,QAAO;KACN,MAAM,aAAa;KACnB,KAAK,OAAO,OAAO;KACnB,KAAK,OAAO,OAAO;KACnB;AAGF,WAAO;KACN,MAAM,aAAa;KACnB,QAAS,OAAO,UAAuB,EAAE;KACzC;;GAGF,iBAAiB,SAA0B;AAC1C,WAAO,CAAC,CAAC,eAAe,MAAM,MAAM,EAAE,SAAS,KAAK;;GAGrD,wBAAwB,MAAc,UAA2B;IAChE,MAAM,SAAS,eAAe,MAAM,MAAM,EAAE,SAAS,KAAK;AAC1D,QAAI,CAAC,UAAU,OAAO,SAAS,aAAa,OAAQ,QAAO;AAC3D,WAAQ,OAAO,QAAqB,SAAS,MAAM,IAAI;;GAGxD,oBAAoB,SAA0B;IAC7C,MAAM,SAAS,eAAe,MAAM,MAAM,EAAE,SAAS,KAAK;AAC1D,WAAO,CAAC,CAAC,UAAU,OAAO,SAAS,aAAa;;GAGjD,oBAAoB,SAA+C;IAClE,MAAM,SAAS,eAAe,MAAM,MAAM,EAAE,SAAS,KAAK;AAC1D,QAAI,CAAC,UAAU,OAAO,SAAS,aAAa,IAAK,QAAO;AACxD,WAAO,CAAC,OAAO,OAAO,GAAG,OAAO,OAAO,EAAE;;GAG1C,eAAe,SAAiB;AAG/B,qBADC,eAAe,QAAQ,MAAM,EAAE,EAAE,SAAS,MAAM,IAAI,EAAE,CACzB;;GAG/B,0BAA0B,MAAc,UAAkB;IACzD,MAAM,eACL,eAAe,QAAQ,MAAM,EAAE,EAAE,SAAS,MAAM,IAAI,EAAE;IACvD,MAAM,SAAS,eAAe,MAAM,MAAM,EAAE,SAAS,KAAK;IAC1D,MAAM,iBACL,QAAQ,SAAS,aAAa,SACzB,OAAO,UAAuB,EAAE,GAClC,EAAE;AAEN,QAAI,eAAe,SAAS,MAAM,EAAE;KACnC,MAAM,YAAY,eAAe,QAAQ,MAAM,MAAM,MAAM;AAC3D,SAAI,UAAU,WAAW,GAAG;AAC3B,uBAAiB,aAAa;AAC9B;;AAED,sBAAiB,CAChB,GAAG,cACH;MAAE;MAAM,MAAM,aAAa;MAAQ,QAAQ;MAAW,CACtD,CAAC;UAEF,kBAAiB,CAChB,GAAG,cACH;KACC;KACA,MAAM,aAAa;KACnB,QAAQ,CAAC,GAAG,gBAAgB,MAAM;KAClC,CACD,CAAC;;GAIJ,oBAAoB,MAAc,KAAa,QAAgB;AAC9D,QAAI,QAAQ,OAAO,QAAQ,GAAG;AAG7B,sBADC,eAAe,QAAQ,MAAM,EAAE,EAAE,SAAS,MAAM,IAAI,EAAE,CACzB;AAC9B;;AAID,qBAAiB,CAChB,GAFA,eAAe,QAAQ,MAAM,EAAE,EAAE,SAAS,MAAM,IAAI,EAAE,EAGtD;KAAE;KAAM,MAAM,aAAa;KAAK;KAAK;KAAK,CAC1C,CAAC;;GAGH,iBAAiB,iBAAyB,KAAc,QAAiB;IACxE,MAAM,oBACL,cAAc,QAAQ,MAAM,EAAE,oBAAoB,gBAAgB,IAClE,EAAE;AAEH,QAAI,CAAC,OAAO,CAAC,KAAK;AACjB,qBAAgB,kBAAkB;AAClC;;IAGD,MAAMA,iBAA8B;KACnC;KACA,GAAI,OAAO,EAAE,KAAK,OAAO,IAAI,EAAE;KAC/B,GAAI,OAAO,EAAE,KAAK,OAAO,IAAI,EAAE;KAC/B;AAED,oBAAgB,CAAC,GAAG,mBAAmB,eAAe,CAAC;;GAGxD,iBAAiB,oBAAqD;AACrE,WAAO,cAAc,MAAM,MAAM,EAAE,oBAAoB,gBAAgB;;GAGxE,yBAAyB;AACxB,oBAAgB,EAAE,CAAC;;GAGpB,uBAAuB;AACtB,IAAK,kBAAkB,MAAM;AAC7B,IAAK,mBAAmB,MAAM;AAC9B,IAAK,iBAAiB,EAAE,CAAC;AACzB,IAAK,cAAc,GAAG;AACtB,IAAK,gBAAgB,EAAE,CAAC;;GAEzB,GACD;GACC;GACA;GACA;GACA;GACA;GACA;GACA;GACA,CACD;EAcA;EACA"}